{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 8,
  "summary": "TypeFaster is a React + TypeScript (Vite) web dapp deployed on the Internet Computer with a Motoko backend canister. Users authenticate via Internet Identity, create a username profile, and play a 5-level timed typing challenge to earn XP. Completed sessions are stored in the canister and used to power personal stats/history and a global leaderboard (best single-session XP, excluding admins). The app also includes an admin-gated dashboard to toggle a competition flag and display canister identity metadata, plus wallet/prize UI flows for ICP that are present in the frontend but currently stubbed pending ICP ledger backend integration.",
  "existing_features": [
    {
      "id": "IF-1",
      "title": "Internet Identity authentication context",
      "synonyms": [
        "II login",
        "AuthClient provider",
        "InternetIdentityProvider"
      ],
      "description": "Provides a React context and hook (useInternetIdentity) to initialize/load an identity from storage, login via Internet Identity, logout/clear state, and expose granular login state flags and errors.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-2",
      "title": "Secret token extraction from URL hash with session persistence",
      "synonyms": [
        "URL hash secret",
        "caffeineAdminToken handling",
        "urlParams utilities"
      ],
      "description": "Utilities read sensitive parameters from the URL hash fragment, persist them in sessionStorage, and clear them from the address bar to reduce leakage (used for admin bootstrap token).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-3",
      "title": "Identity-bound backend actor creation and cache invalidation",
      "synonyms": [
        "useActor",
        "actor per principal",
        "canister actor initialization"
      ],
      "description": "Creates an anonymous actor when logged out and an authenticated actor when logged in; on authenticated creation calls _initializeAccessControlWithSecret and then invalidates/refetches React Query caches that depend on the actor.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-4",
      "title": "Role-based access control in Motoko (admin/user/guest)",
      "synonyms": [
        "AccessControl",
        "MixinAuthorization",
        "RBAC"
      ],
      "description": "Implements user roles and permission checks in Motoko, including initialization via an env-provided admin token + user-provided secret, role queries, admin assignment, and isCallerAdmin checks.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-5",
      "title": "React Query data layer for canister API",
      "synonyms": [
        "useQueries",
        "query caching",
        "mutations"
      ],
      "description": "Centralized hooks for querying/mutating canister state (profile, sessions, leaderboard, competition state, admin check, canister account ID, transaction history) with retries, cache updates, and invalidation patterns.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-6",
      "title": "User profile onboarding modal",
      "synonyms": [
        "ProfileSetupModal",
        "username setup"
      ],
      "description": "Shows a mandatory profile creation modal for new authenticated users (null profile), collects a username, triggers createProfile, and displays special messaging for the first user.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-7",
      "title": "Backend user profile management",
      "synonyms": [
        "createProfile",
        "getCallerUserProfile",
        "saveCallerUserProfile"
      ],
      "description": "Motoko canister stores per-principal profiles with unique usernames, supports profile creation, caller retrieval, admin/user lookup, and saving updates while preserving principal/accountId/isAdmin fields.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-8",
      "title": "First-user flag tracking",
      "synonyms": [
        "firstUserFlag",
        "owner indicator"
      ],
      "description": "Backend tracks the first profile creator principal via firstUserFlag and exposes an authenticated query used by the frontend to show first-user/owner messaging during onboarding.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-9",
      "title": "Typing challenge core gameplay (5 levels, shared timer, XP scoring)",
      "synonyms": [
        "TypingChallenge",
        "typing test",
        "multi-level challenge"
      ],
      "description": "Implements a 5-level typing challenge with a single 10-minute timer, level texts, progress display, and per-word scoring (+5 correct, -10 incorrect, 0 untyped), including finish-on-timeout and manual finish on the last level.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-10",
      "title": "Enhanced Next Level flow with exact-word gating, skip confirmation, and exceeded-words tooltip",
      "synonyms": [
        "Next Level logic",
        "skip-level confirmation",
        "exceeded required words warning"
      ],
      "description": "Next Level advances immediately when exactly the required word count is typed; shows a confirmation dialog when under-typed (Skip/Cancel); blocks advancement and re-shows a warning tooltip when the user has exceeded the required words.",
      "reqIds": [
        "REQ-1",
        "REQ-2",
        "REQ-3",
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "IF-11",
      "title": "Perfect-run time bonus XP rule",
      "synonyms": [
        "time bonus",
        "speed bonus"
      ],
      "description": "Awards a +5 XP per remaining second time bonus only for a perfect run (no mistypes, no skipped levels, no skipped words) that finishes naturally (not manual early finish or timeout).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-12",
      "title": "Basic anti-cheat input restrictions",
      "synonyms": [
        "disable paste",
        "disable drag/drop",
        "disable context menu"
      ],
      "description": "Prevents paste, drag-and-drop, and context menu actions in the typing input and shows toast feedback for blocked actions.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-13",
      "title": "Challenge session persistence and retrieval",
      "synonyms": [
        "saveChallengeSession",
        "getUserChallengeSessions",
        "session history"
      ],
      "description": "Saves completed sessions (principal, timestamp, XP earned) in the canister, allows callers to list their sessions, and invalidates sessions/leaderboard caches after saving.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-14",
      "title": "Stats page (personal totals and session table)",
      "synonyms": [
        "StatsPage",
        "personal analytics"
      ],
      "description": "Displays total XP, session count, average XP, and a session history table with timestamp formatting (nanoseconds → local date/time).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-15",
      "title": "Global leaderboard and public leaderboard preview",
      "synonyms": [
        "LeaderboardPage",
        "public top-10"
      ],
      "description": "Backend computes best single-session XP per user and filters out admins; frontend displays a full leaderboard and a top-10 preview on the login page.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-16",
      "title": "Admin dashboard (permission gating + competition toggle)",
      "synonyms": [
        "AdminDashboard",
        "competitionActive"
      ],
      "description": "Admin-only UI that verifies permissions via isCallerAdmin, shows access denied for non-admins, and allows toggling a backend competitionActive flag (getCompetitionState/setCompetitionState).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-17",
      "title": "App canister identity resolution from env + client-side account ID derivation",
      "synonyms": [
        "appIdentity",
        "donation address derivation",
        "canister principal display"
      ],
      "description": "Resolves the backend canister principal from common Vite/dfx env var keys and derives the canister’s ledger account identifier client-side; used for donation display and admin identity copy actions.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-18",
      "title": "ICP account identifier derivation utility",
      "synonyms": [
        "principalToAccountIdentifier",
        "SHA-224 + CRC32"
      ],
      "description": "Implements ICP account identifier generation from a Principal (domain separator + principal bytes + subaccount, SHA-224 via truncated SHA-256, CRC32 checksum, hex encoding).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-19",
      "title": "Wallet UI (principal/account display + withdrawal UX stub)",
      "synonyms": [
        "WalletPage",
        "withdraw dialog"
      ],
      "description": "Displays the user’s Principal and derived account ID with copy-to-clipboard, shows an (currently stubbed) balance, and provides a withdrawal dialog that validates inputs and calls a stubbed withdraw mutation.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-20",
      "title": "Admin prize send modal and transaction history view (stubbed backend)",
      "synonyms": [
        "SendICPPrizeModal",
        "transaction history"
      ],
      "description": "Provides admin UI to enter recipient account ID and ICP amount for prize sending, with validations and success/error states; queries transaction history for display (though backend does not currently create transactions).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-21",
      "title": "Application shell (header/footer, navigation, robust loading/error states)",
      "synonyms": [
        "App.tsx shell",
        "page state navigation"
      ],
      "description": "Top-level app flow handles initialization, login gating, actor connection states, profile loading/onboarding (null profile → modal), and renders pages within a shared header/footer layout with conditional admin navigation.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-typing-challenge-level-texts-so-that-each-level-s-paragraph-contains-exactly-the-required-number-of-words-for-that-level-level-1-20-words-level-2-50-words-level-3-100-words-level-4-200-words-level-5-500-words",
      "title": "Update the typing challenge level texts so that each level’s paragraph contains exactly the required number of words for that level (Level 1: 20 words, Level 2: 50 words, Level 3: 100 words, Level 4: 200 words, Level 5: 500 words).",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-the-main-menu-heading-text-and-the-choose-an-option-to-continue-subheading-text-from-the-main-menu-page",
      "title": "Remove the 'Main Menu' heading text and the 'Choose an option to continue' subheading text from the main menu page.",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-when-a-typing-test-session-ends-finish-normally-finish-early-or-timeout-display-to-the-user-xp-earned-accuracy-percentage-words-per-minute-wpm-number-of-correct-words-number-of-mistyped-words-and-number-of-untyped-words-only-when-untyped-words-0",
      "title": "When a typing test session ends (finish normally, finish early, or timeout), display to the user: XP earned, accuracy percentage, words per minute (WPM), number of correct words, number of mistyped words, and number of untyped words (only when untyped words > 0).",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-persist-the-displayed-completion-metrics-xp-earned-accuracy-wpm-correct-words-mistyped-words-and-untyped-words-into-each-saved-challenge-session-in-the-backend-and-update-the-stats-page-session-table-so-each-session-entry-includes-these-fields-hiding-untyped-words-when-0",
      "title": "Persist the displayed completion metrics (XP earned, accuracy %, WPM, correct words, mistyped words, and untyped words) into each saved challenge session in the backend, and update the Stats page session table so each session entry includes these fields (hiding untyped words when 0).",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Update each typing level paragraph text so it contains exactly the required word count for that level (to prevent incorrect 'exceeded/required words' warnings).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Remove 'Main Menu' and 'Choose an option to continue' text from the main page (options are self-explanatory).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "On test completion, display XP plus performance stats (accuracy %, WPM, correct words, mistyped words, and untyped words only if > 0) and persist these fields into each session entry shown on the Stats page.",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "architectural_notes": [
    "Frontend uses React Query (@tanstack/react-query) as the primary async data/cache layer, with query keys commonly scoped by the authenticated principal string.",
    "Authentication is implemented via an InternetIdentityProvider wrapping DFINITY AuthClient, with persisted identity loading on mount and a long-lived delegation TTL (30 days).",
    "IC integration uses an “actor per identity” pattern: useActor creates an anonymous actor when logged out and an identity-bound actor when logged in.",
    "Backend authorization is enforced in Motoko via an AccessControl module and a MixinAuthorization mixin, using role checks (#admin/#user/#guest) at method boundaries.",
    "Admin bootstrap uses an environment variable (CAFFEINE_ADMIN_TOKEN) combined with a client-provided secret read from the URL hash/session storage.",
    "UI is built with TailwindCSS and shadcn-style components (cards, dialogs, tooltips, switches), with lucide-react icons and sonner toasts.",
    "Navigation is implemented as a simple in-app page state machine (menu/challenge/stats/wallet/leaderboard/admin) rather than a router library.",
    "Client derives ICP ledger-style account identifiers from Principals using Web Crypto (SHA-256 truncated to SHA-224) plus CRC32 checksum."
  ],
  "known_issues": [
    "ICP ledger integration is not implemented: useGetAppCanisterBalance returns a mock 0 balance; useSendICPPrize and useWithdrawICP throw errors; backend has no corresponding ledger transfer/balance methods.",
    "Backend transactionHistory is never populated (no methods append transactions), so the Admin Dashboard transaction list will stay empty.",
    "Authorization bootstrap canister method _initializeAccessControlWithSecret traps if CAFFEINE_ADMIN_TOKEN is not set, which can break authenticated actor initialization.",
    "AccessControl admin assignment depends on the correct secret token being provided; this conflicts with UI messaging that “the first user to create a profile becomes owner/admin.”",
    "Backend createProfile sets UserProfile.isAdmin based on firstUserFlag but does not synchronize AccessControl roles, potentially causing UI/admin gating inconsistencies.",
    "TypingChallenge uses words.length (text word count) for auto level completion, but uses level.wordCount (requiredWords) for Next Level gating; if these diverge, UX can become inconsistent or impossible to satisfy precisely.",
    "Backend UserProfile.accountId is a placeholder string (\"generated_account_<username>\") and does not match the real ICP account identifier derived client-side.",
    "Canister state (profiles, sessions, roles, flags) is not stored in stable variables and will be lost on canister upgrade.",
    "Internet Identity provider URL is read from process.env.II_URL; in a Vite frontend this may be undefined unless explicitly configured/bridged.",
    "frontend/src/components/SetAppPrincipalModal.tsx exists but is empty/placeholder."
  ],
  "isFixRequest": false,
  "gameProjectType": "none",
  "projectName": "TypeFaster",
  "clarification_mode": "pro",
  "clarification_rounds": 0
}